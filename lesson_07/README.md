# 错误和异常

## 语法错误

语法错误又称解释错误，是在学习Python中最容易遇到的错误

### 异常

即使语句或表达式在语法上是正确的，但在尝试执行时，它仍可能会引发错误。 在执行时检测到的错误被称为*异常*，异常不一定会导致严重后果：你将很快学会如何在Python程序中处理它们。 但是，大多数异常并不会被程序处理，此时会显示如错误信息的错误信息

异常有不同的类型，而其类型名称将会作为错误信息的一部分中打印出来

错误信息的前一部分以堆栈回溯的形式显示发生异常时的上下文。通常它包含列出源代码行的堆栈回溯；但是它不会显示从标准输入中读取的行。

### 处理异常

在Python中，我们可以预先写好处理异常的程序。

*try...except 语句*：

- 首先，执行 try 子句
- 如果没有异常发生，则跳过 except 子句并完成 try 语句的执行。
- 如果在执行 try 子句时发生了异常，则跳过该子句剩下的部分。然后，如果异常的类型和 except 关键字后面的异常匹配，则执行 except 子句，然后继续 执行 try 语句之后的代码。
- 如果发生的异常和 exccept 子句中制定的异常不匹配则将其传递给 try 语句中；如果没有找到处理程序，则它是一个未处理异常，执行将停止并显示以上所示的消息

如果 try 语句可能有多个 except 子句，以指定不同的异常处理程序。最多会执行一个处理程序。处理程序只处理相应的 try 子句中发生的异常，而不处理同一try语句内其他处理程序中的异常。

多个 except 子句可以简写成带多个异常命名为带括号的元组，例如：
~~~python
except (RuntimeError, TypeError, NameEror):
	pass
~~~

如果发生的异常和 except 子句中的类是同一个类或者是他的基类，则异常和 except 子句中的类是兼容的。
如果 except 子句中的异常类有继承关系，而且 try 子句出现的异常跟异常类的子类相匹配，则哪个异常类先定义就捕获哪个异常

*else 语句*：

try... except 语句有一个可选的 else 子句，在使用时必须放在所有的 except 字句后面。它的作用是 try 子句执行完不引发异常时执行的代码

*finally 子句*：

finally 子句是 `try... except` 语句之后的又一个可选子句，它将作为 try 语句结束前的最后一项任务被执行。finall 子句不论 try 语句是否产生了异常都会被执行。

对于一些复杂的情况：

- 如果执行 try 语句期间发生了异常，该异常可由一个 except 子句进行处理。如果异常没有被 except 子句所处理，则该异常会在 finally 子句执行之后被重新引发。
- 异常也可能在 except 或者 else 子句执行期间发生，同样地，该异常会在 finally 子句执行之后被重新引发。
- 如果在执行 try 语句时遇到一个 break， continue 或 return 语句，则 finally 子句将在执行 break, continue 或 return 语句之前被执行。
- 如果 finally 子句中也包含一个 return 语句，则 finally 子句的 return 语句将在 try 子句的 return 语句之前取代后者被执行


在实际应用程序中，finally 子句对于释放外部资源（例如文件或者网络连接）非常有用，无论是否成功使用资源。

### 抛出异常

reaise语句允许程序员强制发生指定的异常。这个参数必须是一个异常实例或者是一个异常类（派生自 Exception 的类）。如果传递的是一个异常类，它将通过调用没有参数的构造函数来隐式实例化：

### 异常参数

except 子句可以在异常名称后面指定一个变量。这个变量和一个异常实例绑定，它的参数存储在 instance.args 中。为了方便起见，异常实例定义了 __str__() ，因此可以直接打印参数而无需引用 .args 。也可以在抛出之前首先实例化异常，并根据需要向其添加任何属性。

### 自定义异常

程序可以通过创建新的异常类来命名自己的异常。异常类通常应该直接或间接地从 Exception 类派生。

可以定义异常类，它可以执行任何其他类可以执行的任何操作，但通常保持简单，通常只提供许多属性，这些属性允许处理程序为异常提取有关错误的信息。在创建可能引发多个不同错误的模块时，通常的做法是为该模块定义的异常创建基类，并为不同错误条件创建特定异常类的子类

大多数异常都定义为名称以“Error”结尾，类似于标准异常的命名。

### 预定义的清理操作

	with 语句允许像文件这样的对象能够以一种确保它们得到及时和正确的清理的方式使用。